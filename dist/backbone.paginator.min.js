/*! backbone.paginator - v0.1.54 - 6/1/2012
* http://github.com/addyosmani/backbone.paginator
* Copyright (c) 2012 Addy Osmani; Licensed MIT */
Backbone.Paginator=function(a,b,c){"use strict";var d={};return d.version="0.15",d.clientPager=a.Collection.extend({initialize:function(){this.sortColumn="",this.sortDirection="desc",this.lastSortColumn="",this.fieldFilterRules=[],this.lastFieldFilterRiles=[],this.filterFields="",this.filterExpression="",this.lastFilterExpression=""},sync:function(a,d,e){var f=this;b.defaults(f.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10}),b.each(f.paginator_ui,function(a,c){b.isUndefined(f[c])&&(f[c]=f.paginator_ui[c])});var g={};b.each(f.server_api,function(a,c){b.isFunction(a)&&(a=b.bind(a,f)),g[c]=a});var h=b.clone(f.paginator_core);return h=b.defaults(h,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),h=b.extend(h,{jsonpCallback:"callback",data:decodeURIComponent(c.param(g)),processData:!1,url:b.result(h,"url")},e),c.ajax(h)},nextPage:function(){this.currentPage=++this.currentPage,this.pager()},previousPage:function(){this.currentPage=--this.currentPage||1,this.pager()},goTo:function(a){a!==undefined&&(this.currentPage=parseInt(a,10),this.pager())},howManyPer:function(a){if(a!==undefined){var b=this.perPage;this.perPage=parseInt(a,10),this.currentPage=Math.ceil((b*(this.currentPage-1)+1)/a),this.pager()}},setSort:function(a,b){a!==undefined&&b!==undefined&&(this.lastSortColumn=this.sortColumn,this.sortColumn=a,this.sortDirection=b,this.pager(),this.info())},setFieldFilter:function(a){b.isEmpty(a)||(this.lastFieldFilterRiles=this.fieldFilterRules,this.fieldFilterRules=a,this.pager(),this.info())},setFilter:function(a,b){a!==undefined&&b!==undefined&&(this.filterFields=a,this.lastFilterExpression=this.filterExpression,this.filterExpression=b,this.pager(),this.info())},pager:function(){var a=this,c=this.perPage,d=(a.currentPage-1)*c,e=d+c;a.origModels===undefined&&(a.origModels=a.models),a.models=a.origModels,this.sortColumn!==""&&(a.models=a._sort(a.models,this.sortColumn,this.sortDirection)),b.isEmpty(this.fieldFilterRules)||(a.models=a._fieldFilter(a.models,this.fieldFilterRules)),this.filterExpression!==""&&(a.models=a._filter(a.models,this.filterFields,this.filterExpression));if(this.lastSortColumn!==this.sortColumn||this.lastFilterExpression!==this.filterExpression||!b.isEqual(this.fieldFilterRules,this.lastFieldFilterRiles))d=0,e=d+c,a.currentPage=1,this.lastSortColumn=this.sortColumn,this.lastFieldFilterRiles=this.fieldFilterRules,this.lastFilterExpression=this.filterExpression;a.sortedAndFilteredModels=a.models,a.reset(a.models.slice(d,e))},_sort:function(a,b,c){return a=a.sort(function(a,d){var e=a.get(b),f=d.get(b);if(!e||!f)return 0;e=e.toString().toLowerCase(),f=f.toString().toLowerCase();if(c==="desc")if(!e.match(/[^\d\.]/)&&e.match(/[\d\.]*/)&&!f.match(/[^\d\.]/)&&f.match(/[\d\.]*/)){if(e-0<f-0)return 1;if(e-0>f-0)return-1}else{if(e<f)return 1;if(e>f)return-1}else if(!e.match(/[^\d\.]/)&&e.match(/[\d\.]*/)&&!f.match(/[^\d\.]/)&&f.match(/[\d\.]*/)){if(e-0<f-0)return-1;if(e-0>f-0)return 1}else{if(e<f)return-1;if(e>f)return 1}return 0}),a},_fieldFilter:function(a,c){if(b.isEmpty(c))return a;var d=[];return b.each(a,function(a){var e=!0;b.each(c,function(c){if(!e)return!1;e=!1;if(c.type==="function"){var d=b.wrap(c.value,function(b){return b(a.get(c.field))});d()&&(e=!0)}else c.type==="required"?b.isEmpty(a.get(c.field).toString())||(e=!0):c.type==="min"?!b.isNaN(Number(a.get(c.field)))&&!b.isNaN(Number(c.value))&&Number(a.get(c.field))>=Number(c.value)&&(e=!0):c.type==="max"?!b.isNaN(Number(a.get(c.field)))&&!b.isNaN(Number(c.value))&&Number(a.get(c.field))<=Number(c.value)&&(e=!0):c.type==="range"?!b.isNaN(Number(a.get(c.field)))&&b.isObject(c.value)&&!b.isNaN(Number(c.value.min))&&!b.isNaN(Number(c.value.max))&&Number(a.get(c.field))>=Number(c.value.min)&&Number(a.get(c.field))<=Number(c.value.max)&&(e=!0):c.type==="minLength"?a.get(c.field).toString().length>=c.value&&(e=!0):c.type==="maxLength"?a.get(c.field).toString().length<=c.value&&(e=!0):c.type==="rangeLength"?b.isObject(c.value)&&!b.isNaN(Number(c.value.min))&&!b.isNaN(Number(c.value.max))&&a.get(c.field).toString().length>=c.value.min&&a.get(c.field).toString().length<=c.value.max&&(e=!0):c.type==="oneOf"?b.isArray(c.value)&&b.include(c.value,a.get(c.field))&&(e=!0):c.type==="equalTo"?c.value===a.get(c.field)&&(e=!0):c.type==="pattern"?a.get(c.field).toString().match(c.value)&&(e=!0):e=!1}),e&&d.push(a)}),d},_filter:function(a,c,d){if(b.isString(c)){var e=c;c=[],c.push(e)}if(d===""||!b.isString(d))return a;d=d.match(/\w+/ig),d=b.uniq(d);var f="("+d.join("|")+")",g=new RegExp(f,"igm"),h=[];return b.each(a,function(a){var e=[];b.each(c,function(c){var d=a.get(c);if(d){var f=a.get(c).toString().match(g);f=b.map(f,function(a){return a.toString().toLowerCase()}),b.each(f,function(a){e.push(a)})}}),e=b.uniq(b.without(e,"")),b.isEmpty(b.difference(d,e))&&h.push(a)}),h},info:function(){var a=this,b={},c=a.sortedAndFilteredModels?a.sortedAndFilteredModels.length:a.length,d=Math.ceil(c/a.perPage);return b={totalRecords:c,currentPage:a.currentPage,perPage:this.perPage,totalPages:d,lastPage:d,previous:!1,next:!1,startRecord:c===0?0:(a.currentPage-1)*this.perPage+1,endRecord:Math.min(c,a.currentPage*this.perPage)},a.currentPage>1&&(b.prev=a.currentPage-1),a.currentPage<b.totalPages&&(b.next=a.currentPage+1),b.pageSet=a.setPagination(b),a.information=b,b},setPagination:function(a){var b=[],c=0,d=0,e=3,f=e*2,g=Math.ceil(a.totalRecords/a.perPage),h=-1;if(g>1)if(g<7+f)for(c=1,d=g;c<=d;c++)b.push(c);else if(g>5+f)if(a.currentPage<1+f)for(c=1,d=4+f;c<d;c++)b.push(c);else if(g-f>a.currentPage&&a.currentPage>f)for(c=a.currentPage-e;c<=a.currentPage+e;c++)b.push(c);else for(c=g-(2+f);c<=g;c++)b.push(c);return b}}),d.requestPager=a.Collection.extend({sync:function(a,d,e){var f=this;b.defaults(f.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10}),b.each(f.paginator_ui,function(a,c){b.isUndefined(f[c])&&(f[c]=f.paginator_ui[c])});var g={};b.each(f.server_api,function(a,c){b.isFunction(a)&&(a=b.bind(a,f)),g[c]=a});var h=b.clone(f.paginator_core);return h=b.defaults(h,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),h=b.extend(h,{jsonpCallback:"callback",data:decodeURIComponent(c.param(g)),processData:!1,url:b.result(h,"url")},e),c.ajax(h)},requestNextPage:function(){this.currentPage!==undefined&&(this.currentPage+=1,this.pager())},requestPreviousPage:function(){this.currentPage!==undefined&&(this.currentPage-=1,this.pager())},updateOrder:function(a){a!==undefined&&(this.sortField=a,this.pager())},goTo:function(a){a!==undefined&&(this.currentPage=parseInt(a,10),this.pager())},howManyPer:function(a){a!==undefined&&(this.currentPage=this.firstPage,this.perPage=a,this.pager())},sort:function(){},info:function(){var a={currentPage:this.currentPage,firstPage:this.firstPage,totalPages:this.totalPages,lastPage:this.totalPages,perPage:this.perPage};return this.information=a,a},pager:function(){this.fetch({})}}),d}(Backbone,_,jQuery);